%D \module
%D   [       file=syst-prm,
%D        version=1999.03.17,
%D          title=\CONTEXT\ System Macros,
%D       subtitle=Primitive Behavior, 
%D         author=Hans Hagen,
%D           date=\currentdate,
%D      copyright={PRAGMA / Hans Hagen \& Ton Otten}]
%C
%C This module is part of the \CONTEXT\ macro||package and is
%C therefore copyrighted by \PRAGMA. See mreadme.pdf for 
%C details. 

\unprotect 

%D Saved primitives are preceded by \type {\normal}, as in: 

\let\normalfmtversion\fmtversion

%D When applicable, we also load the \ETEX\ source and 
%D definition files. 

\bgroup \obeylines 

\ifx\eTeXversion\undefined 

  \long\gdef\beginETEX#1\endETEX%
    {}

  \gdef\beginTEX%
    {\bgroup\obeylines\dobeginTEX}

  \gdef\dobeginTEX#1 
    {\egroup}

  \global\let\endTEX\relax

\else

  \long\gdef\beginTEX#1\endTEX%
    {}

  \gdef\beginETEX% 
    {\bgroup\obeylines\dobeginETEX}

  \gdef\dobeginETEX#1 
    {\egroup\immediate\write16%
       {system (E-TEX) : [line \the\inputlineno] \detokenize{#1}}}

  \global\let\endETEX\relax

\fi 

\ifx\OmegaVersion\undefined 

  \long\gdef\beginOMEGA#1\endOMEGA%
    {}

\else

  \gdef\beginOMEGA% 
    {\bgroup\obeylines\dobeginOMEGA}

  \gdef\dobeginOMEGA#1 
    {\egroup\immediate\write16%
       {system (OMEGA) : [line \the\inputlineno] \string#1}}

  \global\let\endOMEGA\relax

\fi

\egroup

%D Let's get rid of this one: 

\def\wlog#1{} 

%D Just for tracing purposes we set:

\tracingstats=1

%D We don't like outer commands, and we always want access 
%D to the original \type {\input} primitive. 

\let\normalouter = \outer  \let\outer\relax
\let\normalinput = \input  

%D We need to make sure that we start up in \DVI\ mode, so, 
%D after testing for running \PDFTEX, we default to \DVI.  

\ifx\pdftexversion\undefined \newcount\pdfoutput \fi \pdfoutput=0

%D To circumvent dependencies, we can postpone certain 
%D initializations to dumping time, by appending them to the 
%D \type {\everydump} token register. 

\newtoks \everydump 

\let\normaldump \dump 

\def\dump{\the\everydump\normaldump}

\protect \endinput 
